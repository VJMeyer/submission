% AMTAIR Thesis Preamble - Microtype-safe version
% This file is included via header-includes, so be careful about package conflicts

% Typography - conditional microtype loading
\@ifpackageloaded{microtype}{
  % microtype already loaded by Quarto, just configure it
  \microtypesetup{protrusion=true,expansion=true}
}{
  % microtype not loaded, load it with options
  \usepackage[protrusion=true,expansion=true]{microtype}
}

% Spacing
\usepackage{setspace}
\onehalfspacing

% Enhanced cross-referencing (only if not already loaded)
\@ifpackageloaded{cleveref}{}{
  \usepackage{cleveref}
  \crefformat{section}{Section~#2#1#3}
  \crefformat{figure}{Figure~#2#1#3}
  \crefformat{table}{Table~#2#1#3}
  \crefformat{equation}{Equation~#2#1#3}
}

% Callout support with tcolorbox
\usepackage{tcolorbox}
\tcbuselibrary{skins,breakable}

% Define callout environments for Quarto compatibility
\newtcolorbox{callout-note-env}{
  enhanced,breakable,
  colback=blue!5!white,colframe=blue!75!black,
  title=Note,fonttitle=\bfseries,
  attach boxed title to top left={yshift=-2mm},
  boxed title style={colback=blue!75!black}
}

\newtcolorbox{callout-tip-env}{
  enhanced,breakable,
  colback=green!5!white,colframe=green!75!black,
  title=Tip,fonttitle=\bfseries,
  attach boxed title to top left={yshift=-2mm},
  boxed title style={colback=green!75!black}
}

\newtcolorbox{callout-warning-env}{
  enhanced,breakable,
  colback=orange!5!white,colframe=orange!75!black,
  title=Warning,fonttitle=\bfseries,
  attach boxed title to top left={yshift=-2mm},
  boxed title style={colback=orange!75!black}
}

% Header and footer styling
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{\slshape\nouppercase{\rightmark}}
\fancyhead[LO,RE]{\slshape\nouppercase{\leftmark}}
\fancyfoot[C]{\thepage}

% Enhanced figure placement
\usepackage{float}
\floatplacement{figure}{H}
\floatplacement{table}{H}

% List formatting
\usepackage{enumitem}
\setlist[itemize]{topsep=0pt,partopsep=0pt,parsep=0pt,itemsep=2pt}
\setlist[enumerate]{topsep=0pt,partopsep=0pt,parsep=0pt,itemsep=2pt}

% Math environments
\usepackage{amsthm}
\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]
\newtheorem{example}{Example}[section]
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{proposition}{Proposition}[section]

% URL styling
\urlstyle{same}

% Custom commands for thesis metadata
\newcommand{\thesistitle}{Automating the Modelling of Transformative Artificial Intelligence Risks}
\newcommand{\thesisauthor}{Valentin Jakob Meyer}